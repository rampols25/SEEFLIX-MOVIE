<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SEEFLIX — Cinematic Player</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7977700940936581"
    crossorigin="anonymous"></script>

  <!-- Custom ad script -->
  <script src="https://fpyf8.com/88/tag.min.js" data-zone="178048" async data-cfasync="false"></script>

  <style>
    :root { --bg:#0b0b0b; --panel:#0f1720; --muted:#9ca3af; }
    html,body { height:100%; background:var(--bg); color:#fff; margin:0; font-family:Inter,system-ui,Arial; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    /* Modal cinematic full-screen look */
    #modal { background: #000; }
    .player-iframe { width:100%; height:calc(56.25vw); min-height:220px; max-height:70vh; border:0; background:#000; }
    /* Make player wider on desktop */
    @media(min-width:1024px){
      .player-iframe { height:56.25vh; min-height:360px; }
    }

    /* episodes horizontal row */
    .episodes-row { display:flex; gap:10px; overflow-x:auto; padding:8px 4px; -webkit-overflow-scrolling:touch; }
    .episode-card { min-width:160px; max-width:200px; background: rgba(255,255,255,0.02); padding:8px; border-radius:8px; display:flex; gap:8px; align-items:center; cursor:pointer; transition:transform .12s ease, background .12s; }
    .episode-card:hover{ transform:translateY(-4px); background: rgba(255,255,255,0.04); }
    .episode-thumb { width:110px; height:62px; object-fit:cover; border-radius:6px; flex-shrink:0; }
    .episode-meta { font-size:13px; line-height:1.1; color:#e6eef8; }
    .episode-number { font-weight:600; color:#fff; }
    .episode-title { color:var(--muted); font-size:12px; margin-top:4px; }

    /* Hide thumbnails on mobile (user requested) */
    @media(max-width:640px){
      .episode-thumb { display:none !important; width:0; height:0; margin:0; }
      .episode-card { min-width:120px; padding:10px; }
      .player-iframe { height:56vw; } /* approximate 16:9 on mobile */
      .modal-inner { height:100vh; width:100vw; border-radius:0; }
      .content-wrap { padding:12px; }
    }

    /* Cinematic padding + container */
    .modal-inner { width:95%; max-width:1100px; height:85vh; border-radius:10px; overflow:hidden; display:flex; flex-direction:column; background:linear-gradient(180deg,#020202 0%, #071018 100%); }
    .content-wrap { display:flex; flex-direction:column; gap:12px; padding:16px; overflow:auto; }

    /* Title / meta */
    .title-row { display:flex; gap:12px; align-items:flex-start; }
    .poster { width:110px; height:160px; object-fit:cover; border-radius:8px; flex-shrink:0; }
    .meta { display:flex; flex-direction:column; gap:6px; }
    .muted { color:var(--muted); font-size:13px; }

    /* suggested thumbnails */
    .suggested-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
    .suggested-thumb { width:100%; height:130px; object-fit:cover; border-radius:6px; }

    /* floating close/back */
    #btn-close, #btn-back { position:fixed; top:18px; z-index:9999; background:rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.04); padding:8px; border-radius:999px; display:flex; align-items:center; justify-content:center; }
    #btn-close { right:18px; }
    #btn-back { left:18px; display:none; } /* visible on mobile by script/css */

    /* small scrollbar tweaks */
    .episodes-row::-webkit-scrollbar { height:8px; }
    .episodes-row::-webkit-scrollbar-thumb { background:rgba(255,255,255,0.06); border-radius:8px; }
  </style>
</head>
<body>

  <!-- Header simple -->
  <header class="bg-transparent sticky top-0 z-30">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="text-2xl font-bold text-red-500">SEEFLIX</div>
      <div class="flex gap-2 items-center">
        <input id="search-top" class="bg-[#0b1120] px-3 py-2 rounded text-sm w-48" placeholder="Search (press Enter)" />
        <button id="open-search" class="bg-red-600 px-3 py-2 rounded text-sm">Search</button>
      </div>
    </div>
  </header>

  <!-- Banner -->
  <section id="banner" class="h-48 bg-cover bg-center flex items-end" style="background-color:#060606;">
    <div class="w-full bg-gradient-to-t from-black/80 to-transparent p-4">
      <h2 id="banner-title" class="text-2xl font-bold px-4"></h2>
    </div>
  </section>

  <!-- lists -->
  <main class="max-w-6xl mx-auto px-4 py-6 space-y-8">
    <section>
      <h3 class="text-lg font-semibold mb-3">Trending Movies</h3>
      <div id="movies-list" class="flex gap-3 overflow-x-auto pb-2"></div>
    </section>

    <section>
      <h3 class="text-lg font-semibold mb-3">Trending TV Shows</h3>
      <div id="tv-list" class="flex gap-3 overflow-x-auto pb-2"></div>
    </section>

    <section>
      <h3 class="text-lg font-semibold mb-3">Trending Anime</h3>
      <div id="anime-list" class="flex gap-3 overflow-x-auto pb-2"></div>
    </section>
  </main>

  <!-- Cinematic Modal -->
  <div id="modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black">
    <div class="modal-inner mx-auto">
      <!-- Floating buttons -->
      <button id="btn-back" aria-label="Back" title="Back">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="white">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <button id="btn-close" aria-label="Close" title="Close">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="white">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>

      <!-- PLAYER -->
      <div id="player-wrap" class="bg-black">
        <iframe id="player" class="player-iframe" allowfullscreen allow="autoplay; encrypted-media"></iframe>
      </div>

      <!-- Content below player -->
      <div class="content-wrap">
        <div class="title-row">
          <img id="modal-poster" class="poster" src="" alt="poster" />
          <div class="meta flex-1">
            <div id="modal-title" class="text-2xl font-semibold"></div>
            <div class="muted" id="modal-sub"></div>
            <div class="mt-2 muted" id="modal-rating"></div>
          </div>
        </div>

        <!-- controls: server + season -->
        <div class="flex gap-3 items-center">
          <div class="flex-1">
            <label class="muted text-xs">Server</label>
            <select id="server" class="w-full bg-[#071018] p-2 rounded mt-1">
              <option value="vidsrc.cc">vidsrc.cc</option>
              <option value="vidsrc.me">vidsrc.me</option>
              <option value="player.videasy.net">player.videasy.net</option>
            </select>
          </div>
          <div style="width:160px">
            <label class="muted text-xs">Season</label>
            <select id="season-select" class="w-full bg-[#071018] p-2 rounded mt-1 hidden"></select>
          </div>
        </div>

        <!-- episode horizontal row -->
        <div>
          <label class="muted text-xs">Episodes</label>
          <div id="episodes-row" class="episodes-row mt-2"></div>
        </div>

        <!-- short description -->
        <div>
          <label class="muted text-xs">Description</label>
          <p id="modal-desc" class="muted mt-1 text-sm"></p>
        </div>

        <!-- suggested -->
        <div>
          <label class="muted text-xs">Suggested</label>
          <div id="suggested" class="suggested-grid mt-2"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Search modal (simple) -->
  <div id="search-modal" class="fixed inset-0 z-40 hidden items-center justify-center bg-black/90 p-4">
    <div class="max-w-3xl w-full bg-[#071018] rounded p-4">
      <div class="flex gap-2 mb-3">
        <input id="search-input" class="flex-1 bg-[#0b1220] p-3 rounded text-sm" placeholder="Search movies, tv or anime..." />
        <button id="close-search" class="bg-red-600 px-3 py-2 rounded">Close</button>
      </div>
      <div id="search-results" class="flex gap-3 overflow-x-auto"></div>
    </div>
  </div>

  <script>
    // CONFIG
    const API_KEY = '169689830f09449f1d23896257d507db';
    const BASE = 'https://api.themoviedb.org/3';
    const IMG = 'https://image.tmdb.org/t/p/w500';

    // DOM shortcuts
    const el = id => document.getElementById(id);

    // State
    let current = null;           // movie/tv object
    let currentEpisode = null;    // episode object
    let currentSeason = null;

    // Helper: safe image
    const safeImg = (path,w=300) => path ? IMG+path : `https://via.placeholder.com/${w}x${Math.round(w*1.5)}?text=No+Image`;

    // Fetch helper
    async function fetchJSON(url){
      const res = await fetch(url);
      if(!res.ok) throw new Error('Network error');
      return res.json();
    }

    // Render tile used in lists and search
    function tile(item){
      const img = document.createElement('img');
      img.src = safeImg(item.poster_path||item.backdrop_path, 300);
      img.alt = item.title||item.name;
      img.className = 'w-32 h-48 object-cover rounded cursor-pointer hover:scale-105 transition';
      img.addEventListener('click', ()=> openModalFor(item));
      return img;
    }

    // Populate main lists
    async function loadHome(){
      try {
        const [movies, tv] = await Promise.all([
          fetchJSON(`${BASE}/trending/movie/week?api_key=${API_KEY}`),
          fetchJSON(`${BASE}/trending/tv/week?api_key=${API_KEY}`)
        ]);
        const animePages = await Promise.all([
          fetchJSON(`${BASE}/trending/tv/week?api_key=${API_KEY}&page=1`),
          fetchJSON(`${BASE}/trending/tv/week?api_key=${API_KEY}&page=2`)
        ]);
        // quick filter anime (genre 16 animation and ja)
        const anime = (animePages.flatMap(p=>p.results)).filter(i => i.original_language === 'ja' && (i.genre_ids||[]).includes(16));

        el('banner-title').textContent = movies.results?.[0]?.title || movies.results?.[0]?.name || 'SEEFLIX';
        document.getElementById('banner').style.backgroundImage = `linear-gradient(0deg, rgba(0,0,0,0.7), rgba(0,0,0,0.0)), url('${safeImg(movies.results?.[0]?.backdrop_path,800)}')`;

        (movies.results||[]).slice(0,18).forEach(m => el('movies-list').appendChild(tile(m)));
        (tv.results||[]).slice(0,18).forEach(t => el('tv-list').appendChild(tile(t)));
        (anime||[]).slice(0,18).forEach(a => el('anime-list').appendChild(tile(a)));
      } catch(e){
        console.error(e);
      }
    }

    // OPEN modal for item (movie or tv)
    async function openModalFor(item){
      current = item;
      currentEpisode = null;
      currentSeason = null;

      // set UI
      el('modal-title').textContent = item.title || item.name || 'Untitled';
      el('modal-desc').textContent = item.overview || 'No description available';
      el('modal-poster').src = safeImg(item.poster_path||item.backdrop_path,300);
      el('modal-sub').textContent = item.release_date ? `Release: ${item.release_date}` : (item.first_air_date ? `First air: ${item.first_air_date}` : '');
      el('modal-rating').textContent = item.vote_average ? `Rating: ${item.vote_average}/10` : '';

      // reset episodes & suggested
      el('episodes-row').innerHTML = '';
      el('suggested').innerHTML = '';
      el('season-select').innerHTML = '';
      el('season-select').classList.add('hidden');

      // set player immediately for movies
      if(item.media_type === 'movie' || item.title && !item.first_air_date){
        setPlayerForMovie(item.id);
        // load suggested movies
        loadSuggested(item.id, 'movie');
      } else {
        // tv -> load seasons then autoplay first ep
        await loadSeasons(item.id);
        loadSuggested(item.id, 'tv');
      }

      // show modal (cinematic full-screen feel)
      document.body.style.overflow = 'hidden';
      el('modal').classList.remove('hidden');

      // show mobile back button if narrow
      updateBackVisibility();
    }

    // Close handlers
    function closeModal(){
      el('player').src = '';
      el('modal').classList.add('hidden');
      document.body.style.overflow = '';
    }

    // Back visibility
    function updateBackVisibility(){
      const btnBack = el('btn-back');
      if(window.innerWidth <= 640) btnBack.style.display = 'flex'; else btnBack.style.display = 'none';
    }

    // Player URL builders
    function movieEmbed(server, id){
      if(server==='vidsrc.cc') return `https://vidsrc.cc/v2/embed/movie/${id}`;
      if(server==='vidsrc.me' || server==='vidsrc.net') return `https://vidsrc.net/embed/movie/?tmdb=${id}`;
      if(server==='player.videasy.net') return `https://player.videasy.net/movie/${id}`;
      return `https://vidsrc.cc/v2/embed/movie/${id}`;
    }
    function episodeEmbed(server, tvId, seasonNum, epNum){
      if(server==='vidsrc.cc') return `https://vidsrc.cc/v2/embed/tv/${tvId}/${seasonNum}/${epNum}`;
      if(server==='vidsrc.me' || server==='vidsrc.net') return `https://vidsrc.net/embed/tv/?tmdb=${tvId}&season=${seasonNum}&episode=${epNum}`;
      if(server==='player.videasy.net') return `https://player.videasy.net/tv/${tvId}/${seasonNum}/${epNum}`;
      return `https://vidsrc.cc/v2/embed/tv/${tvId}/${seasonNum}/${epNum}`;
    }

    // Set player for movie
    function setPlayerForMovie(movieId){
      const server = el('server').value;
      el('player').src = movieEmbed(server, movieId);
      el('episodes-row').classList.add('hidden');
    }

    // Load seasons and populate season-select
    async function loadSeasons(tvId){
      try {
        const tv = await fetchJSON(`${BASE}/tv/${tvId}?api_key=${API_KEY}`);
        const seasons = tv.seasons || [];
        if(!seasons.length) return;

        el('season-select').classList.remove('hidden');
        el('season-select').innerHTML = '';
        seasons.forEach(s=>{
          const opt = document.createElement('option');
          opt.value = s.season_number;
          opt.textContent = `Season ${s.season_number}${s.name ? ' - ' + s.name : ''}`;
          el('season-select').appendChild(opt);
        });

        // pick first season (non-zero if possible)
        let first = seasons.find(s => s.season_number>0) || seasons[0];
        if(!first) first = seasons[0];
        el('season-select').value = first.season_number;
        currentSeason = first.season_number;

        // load episodes for this season
        await loadEpisodes(tvId, currentSeason);

        // on change
        el('season-select').onchange = async (e) => {
          currentSeason = parseInt(e.target.value);
          await loadEpisodes(tvId, currentSeason);
          // autoplay first episode of new season
          const firstCard = el('episodes-row').querySelector('.episode-card');
          if(firstCard) firstCard.click();
        };

      } catch(err){
        console.warn('seasons error', err);
      }
    }

    // Load episodes horizontally
    async function loadEpisodes(tvId, seasonNumber){
      try {
        const season = await fetchJSON(`${BASE}/tv/${tvId}/season/${seasonNumber}?api_key=${API_KEY}`);
        const eps = season.episodes || [];
        const row = el('episodes-row');
        row.innerHTML = '';
        if(!eps.length){ row.classList.add('hidden'); return; }
        row.classList.remove('hidden');

        eps.forEach(ep => {
          const card = document.createElement('div');
          card.className = 'episode-card';
          card.innerHTML = `
            <img class="episode-thumb" src="${safeImg(ep.still_path,300)}" alt="${ep.name||''}" />
            <div style="flex:1">
              <div class="episode-number">E${ep.episode_number} · ${ep.name||'Untitled'}</div>
              <div class="episode-title">${(ep.air_date||'')}</div>
            </div>
          `;
          card.addEventListener('click', ()=>{
            currentEpisode = ep;
            playEpisode(tvId, seasonNumber, ep.episode_number);
            // highlight
            row.querySelectorAll('.episode-card').forEach(n=>n.style.border='');
            card.style.border = '1px solid rgba(255,255,255,0.08)';
          });
          row.appendChild(card);
        });

        // autoplay first episode
        const first = row.querySelector('.episode-card');
        if(first) {
          first.click();
        }
      } catch(e){
        console.warn('episodes error', e);
      }
    }

    function playEpisode(tvId, seasonNum, epNum){
      const server = el('server').value;
      el('player').src = episodeEmbed(server, tvId, seasonNum, epNum);
    }

    // server change: update current playing stream
    el('server').addEventListener('change', ()=>{
      if(!current) return;
      if(current.media_type==='movie' || (current.title && !current.first_air_date)){
        setPlayerForMovie(current.id);
      } else if(currentEpisode && currentSeason) {
        playEpisode(current.id, currentSeason, currentEpisode.episode_number);
      } else {
        // if no episode selected, autoplay first after load
      }
    });

    // Suggested loader
    async function loadSuggested(id, type){
      try {
        let data = [];
        if(type === 'movie'){
          const res = await fetchJSON(`${BASE}/movie/${id}/similar?api_key=${API_KEY}`);
          data = res.results || [];
        }
        if(!data.length){
          const t = await fetchJSON(`${BASE}/trending/movie/week?api_key=${API_KEY}`);
          data = t.results || [];
        }
        const grid = el('suggested');
        grid.innerHTML = '';
        (data.slice(0,6)).forEach(s=>{
          const img = document.createElement('img');
          img.src = safeImg(s.poster_path,300);
          img.className = 'suggested-thumb cursor-pointer';
          img.addEventListener('click', ()=> openModalFor(s));
          grid.appendChild(img);
        });
      } catch(e){ console.warn('suggested error', e); }
    }

    // Search handling
    async function search(q){
      if(!q || !q.trim()) return;
      try {
        const res = await fetchJSON(`${BASE}/search/multi?api_key=${API_KEY}&query=${encodeURIComponent(q)}`);
        const items = res.results || [];
        el('search-results').innerHTML='';
        items.forEach(it => {
          if(!it.poster_path) return;
          el('search-results').appendChild(tile(it));
        });
      } catch(e){ console.warn('search error', e); }
    }

    // Events & init
    document.addEventListener('DOMContentLoaded', ()=>{
      loadHome();

      // open search UI
      el('open-search').addEventListener('click', ()=> {
        el('search-modal').classList.remove('hidden');
        el('search-input').focus();
      });
      el('close-search').addEventListener('click', ()=> el('search-modal').classList.add('hidden'));

      // search input enter
      el('search-top').addEventListener('keydown', (e)=> {
        if(e.key === 'Enter') {
          const q = e.target.value.trim();
          if(q){
            el('search-modal').classList.remove('hidden');
            el('search-input').value = q;
            search(q);
          }
        }
      });
      el('search-input').addEventListener('input', (e)=> search(e.target.value));

      // modal close/back
      el('btn-close').addEventListener('click', closeModal);
      el('btn-back').addEventListener('click', closeModal);

      // ESC closes modal/search
      document.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape'){
          if(!el('modal').classList.contains('hidden')) closeModal();
          if(!el('search-modal').classList.contains('hidden')) el('search-modal').classList.add('hidden');
        }
      });

      // keep mobile back visibility updated
      window.addEventListener('resize', updateBackVisibility);
      updateBackVisibility();
    });
  </script>
</body>
</html>
